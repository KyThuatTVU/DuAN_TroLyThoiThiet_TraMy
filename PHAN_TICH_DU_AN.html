<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhÃ¢n TÃ­ch Dá»± Ãn - Trá»£ LÃ½ Thá»i Tiáº¿t TrÃ  My AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @page {
            margin: 2cm;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            font-size: 2.5em;
            text-align: center;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 30px;
            font-size: 1.8em;
        }
        
        h3 {
            color: #2980b9;
            margin-top: 20px;
            font-size: 1.4em;
        }
        
        h4 {
            color: #16a085;
            margin-top: 15px;
            font-size: 1.2em;
        }
        
        .metadata {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 30px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        
        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-left: 4px solid #3498db;
            margin: 30px 0;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .toc a {
            color: #2980b9;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        code {
            background: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
            font-size: 0.9em;
        }
        
        pre code {
            background: transparent;
            color: #ecf0f1;
            padding: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        tr:hover {
            background: #e8f4f8;
        }
        
        .diagram {
            background: #f8f9fa;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            overflow-x: auto;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .feature-list li:before {
            content: "âœ…";
            position: absolute;
            left: 0;
        }
        
        .endpoint {
            background: #f1f8ff;
            border: 1px solid #c8e1ff;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .endpoint-method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 10px;
        }
        
        .method-get {
            background: #61affe;
            color: white;
        }
        
        .method-post {
            background: #49cc90;
            color: white;
        }
        
        .page-break {
            page-break-after: always;
        }
        
        .summary-box {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .warning-box {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        @media print {
            body {
                font-size: 11pt;
            }
            
            .page-break {
                page-break-after: always;
            }
            
            pre, .diagram {
                page-break-inside: avoid;
            }
            
            .export-buttons {
                display: none !important;
            }
        }
        
        /* Export Buttons Styling */
        .export-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            gap: 10px;
        }
        
        .export-btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .export-btn:active {
            transform: translateY(0);
        }
        
        .btn-pdf {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-word {
            background: linear-gradient(135deg, #2b5797, #1e3a5f);
            color: white;
        }
        
        .btn-print {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<!-- Export Buttons -->
<div class="export-buttons">
    <button class="export-btn btn-pdf" onclick="exportToPDF()">
        <span>ğŸ“„</span>
        <span id="pdf-text">Xuáº¥t PDF</span>
    </button>
    <button class="export-btn btn-word" onclick="exportToWord()">
        <span>ğŸ“</span>
        <span>Xuáº¥t Word</span>
    </button>
    <button class="export-btn btn-print" onclick="printDocument()">
        <span>ğŸ–¨ï¸</span>
        <span>In</span>
    </button>
</div>

<div id="content">

<h1>ğŸŒ¤ï¸ PHÃ‚N TÃCH Dá»° ÃN<br>TRá»¢ LÃ THá»œI TIáº¾T TRÃ€ MY AI</h1>

<div class="metadata">
    <p><strong>NgÃ y phÃ¢n tÃ­ch:</strong> 11/10/2025</p>
    <p><strong>Dá»± Ã¡n:</strong> Há»‡ thá»‘ng trá»£ lÃ½ thá»i tiáº¿t thÃ´ng minh vá»›i SOAP & REST API</p>
    <p><strong>Repository:</strong> DuAN_TroLyThoiThiet_TraMy</p>
    <p><strong>Owner:</strong> KyThuatTVU</p>
</div>

<div class="toc">
    <h2>ğŸ“‹ Má»¤C Lá»¤C</h2>
    <ul>
        <li><a href="#section-1">1. Tá»•ng quan dá»± Ã¡n</a></li>
        <li><a href="#section-2">2. Kiáº¿n trÃºc há»‡ thá»‘ng</a></li>
        <li><a href="#section-3">3. PhÃ¢n tÃ­ch dá»¯ liá»‡u thá»i tiáº¿t</a></li>
        <li><a href="#section-4">4. PhÃ¢n tÃ­ch dá»¯ liá»‡u báº£n Ä‘á»“</a></li>
        <li><a href="#section-5">5. PhÃ¢n tÃ­ch chá»©c nÄƒng chat AI</a></li>
        <li><a href="#section-6">6. Cáº¥u trÃºc thÆ° má»¥c</a></li>
        <li><a href="#section-7">7. API Endpoints</a></li>
        <li><a href="#section-8">8. CÃ´ng nghá»‡ sá»­ dá»¥ng</a></li>
        <li><a href="#section-9">9. SÆ¡ Ä‘á»“ luá»“ng dá»¯ liá»‡u chi tiáº¿t</a></li>
        <li><a href="#section-10">10. Káº¿t luáº­n</a></li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="section-1">1. Tá»”NG QUAN Dá»° ÃN</h2>

<h3>1.1 MÃ´ táº£</h3>
<p>Dá»± Ã¡n <strong>Trá»£ lÃ½ thá»i tiáº¿t TrÃ  My AI</strong> lÃ  má»™t á»©ng dá»¥ng web tÃ­ch há»£p nhiá»u cÃ´ng nghá»‡ Ä‘á»ƒ cung cáº¥p thÃ´ng tin thá»i tiáº¿t thÃ´ng minh, há»— trá»£:</p>
<ul class="feature-list">
    <li>Tra cá»©u thá»i tiáº¿t theo thÃ nh phá»‘</li>
    <li>Hiá»ƒn thá»‹ báº£n Ä‘á»“ vá»‹ trÃ­</li>
    <li>Chatbot AI vá»›i kháº£ nÄƒng phÃ¢n tÃ­ch áº£nh thá»i tiáº¿t</li>
    <li>TÃ­ch há»£p SOAP vÃ  REST API</li>
</ul>

<h3>1.2 TÃ­nh nÄƒng chÃ­nh</h3>
<div class="summary-box">
    <ul class="feature-list">
        <li>Tra cá»©u thá»i tiáº¿t hiá»‡n táº¡i vÃ  dá»± bÃ¡o</li>
        <li>Hiá»ƒn thá»‹ báº£n Ä‘á»“ tÆ°Æ¡ng tÃ¡c (OpenStreetMap, Google Maps)</li>
        <li>Chat vá»›i AI (Google Gemini 2.0)</li>
        <li>PhÃ¢n tÃ­ch áº£nh thá»i tiáº¿t báº±ng AI Vision</li>
        <li>Giao diá»‡n Ä‘áº¹p, responsive</li>
        <li>Drag & drop upload áº£nh</li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="section-2">2. KIáº¾N TRÃšC Há»† THá»NG</h2>

<h3>2.1 SÆ¡ Ä‘á»“ kiáº¿n trÃºc tá»•ng quan</h3>
<div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (HTML/JS)                    â”‚
â”‚              Frontend/index.html                         â”‚
â”‚  - Giao diá»‡n ngÆ°á»i dÃ¹ng                                 â”‚
â”‚  - Xá»­ lÃ½ tÆ°Æ¡ng tÃ¡c                                      â”‚
â”‚  - Gá»i API Backend                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BACKEND (Node.js/Express)               â”‚
â”‚                   Backend/server.js                      â”‚
â”‚  - REST API Server                                      â”‚
â”‚  - SOAP Service                                         â”‚
â”‚  - Routing & Middleware                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Weather    â”‚   â”‚     Map      â”‚   â”‚  Chat AI     â”‚
â”‚   Service    â”‚   â”‚   Service    â”‚   â”‚   Service    â”‚
â”‚   (SOAP)     â”‚   â”‚   (SOAP)     â”‚   â”‚   (REST)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚OpenWeatherMapâ”‚   â”‚OpenWeatherMapâ”‚   â”‚ Google       â”‚
â”‚ Weather API  â”‚   â”‚ Geocoding APIâ”‚   â”‚ Gemini AI    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
</div>

<h3>2.2 Kiáº¿n trÃºc Backend</h3>
<div class="diagram">
<pre>
Backend/
â”œâ”€â”€ server.js                    # Main server file
â”œâ”€â”€ config.js                    # Configuration
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ index.js                # API routing
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ weatherController.js    # Weather logic
â”‚   â”œâ”€â”€ chatController.js       # Chat logic
â”‚   â””â”€â”€ imageWeatherController.js
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ geminiService.js        # AI service
â”‚   â”œâ”€â”€ mapService.js           # Map service
â”‚   â””â”€â”€ googleSearchService.js  # Search service
â”œâ”€â”€ soap/
â”‚   â”œâ”€â”€ weatherService.js       # SOAP service
â”‚   â””â”€â”€ weatherWsdl.xml         # WSDL definition
â””â”€â”€ middleware/
    â”œâ”€â”€ index.js                # Middleware setup
    â””â”€â”€ upload.js               # Image upload handler
</pre>
</div>

<div class="page-break"></div>

<h2 id="section-3">3. PHÃ‚N TÃCH Dá»® LIá»†U THá»œI TIáº¾T</h2>

<h3>3.1 Nguá»“n láº¥y dá»¯ liá»‡u thá»i tiáº¿t</h3>

<h4>ğŸ“ File nguá»“n</h4>
<p><strong>File:</strong> <code>Backend/soap/weatherService.js</code><br>
<strong>Function:</strong> <code>getWeatherLogic(cityName)</code></p>

<h4>ğŸŒ API sá»­ dá»¥ng</h4>
<ul>
    <li><strong>Provider:</strong> OpenWeatherMap API</li>
    <li><strong>API Key:</strong> Cáº¥u hÃ¬nh trong biáº¿n <code>OPENWEATHER_API_KEY</code> (file <code>.env</code>)</li>
</ul>

<h4>ğŸ“¡ Endpoints gá»i</h4>
<div class="endpoint">
    <p><strong>1. Current Weather API</strong></p>
    <pre><code>GET https://api.openweathermap.org/data/2.5/weather
Parameters: 
- q: tÃªn thÃ nh phá»‘
- appid: API key
- units: metric (Celsius)
- lang: vi (Tiáº¿ng Viá»‡t)</code></pre>
</div>

<div class="endpoint">
    <p><strong>2. Forecast API</strong> (dá»± bÃ¡o 5 ngÃ y)</p>
    <pre><code>GET https://api.openweathermap.org/data/2.5/forecast
Parameters:
- lat, lon: tá»a Ä‘á»™ tá»« Current Weather API
- appid: API key
- units: metric
- lang: vi</code></pre>
</div>

<h4>ğŸ“Š Dá»¯ liá»‡u thu tháº­p Ä‘Æ°á»£c</h4>
<table>
    <thead>
        <tr>
            <th>TrÆ°á»ng dá»¯ liá»‡u</th>
            <th>MÃ´ táº£</th>
            <th>ÄÆ¡n vá»‹</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>temperature</code></td>
            <td>Nhiá»‡t Ä‘á»™ hiá»‡n táº¡i</td>
            <td>Â°C</td>
        </tr>
        <tr>
            <td><code>humidity</code></td>
            <td>Äá»™ áº©m</td>
            <td>%</td>
        </tr>
        <tr>
            <td><code>description</code></td>
            <td>MÃ´ táº£ thá»i tiáº¿t</td>
            <td>Text (Tiáº¿ng Viá»‡t)</td>
        </tr>
        <tr>
            <td><code>windSpeed</code></td>
            <td>Tá»‘c Ä‘á»™ giÃ³</td>
            <td>km/h</td>
        </tr>
        <tr>
            <td><code>feelsLike</code></td>
            <td>Cáº£m giÃ¡c nhÆ°</td>
            <td>Â°C</td>
        </tr>
        <tr>
            <td><code>visibility</code></td>
            <td>Táº§m nhÃ¬n</td>
            <td>km</td>
        </tr>
        <tr>
            <td><code>uvIndex</code></td>
            <td>Chá»‰ sá»‘ UV</td>
            <td>0-10</td>
        </tr>
        <tr>
            <td><code>cityName</code></td>
            <td>TÃªn thÃ nh phá»‘</td>
            <td>Text</td>
        </tr>
        <tr>
            <td><code>icon</code></td>
            <td>MÃ£ icon thá»i tiáº¿t</td>
            <td>Code</td>
        </tr>
        <tr>
            <td><code>tempMax/tempMin</code></td>
            <td>Nhiá»‡t Ä‘á»™ cao nháº¥t/tháº¥p nháº¥t</td>
            <td>Â°C</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h3>3.2 CÃ¡ch tráº£ vá» káº¿t quáº£ thá»i tiáº¿t</h3>

<h4>âœ… PhÆ°Æ¡ng thá»©c 1: SOAP Service</h4>
<div class="highlight">
    <p><strong>ğŸ“ Location:</strong> <code>Backend/soap/weatherService.js</code><br>
    <strong>Function:</strong> <code>weatherServiceDefinition.WeatherService.WeatherPort.getWeather()</code></p>
    <p><strong>Endpoint:</strong> <code>POST http://localhost:3000/weather</code><br>
    <strong>Protocol:</strong> SOAP 1.1<br>
    <strong>Content-Type:</strong> <code>text/xml</code></p>
</div>

<p><strong>SOAP Request Example:</strong></p>
<pre><code>&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" 
                  xmlns:weat="http://example.com/weather"&gt;
   &lt;soapenv:Header/&gt;
   &lt;soapenv:Body&gt;
      &lt;weat:getWeatherRequest&gt;
         &lt;city&gt;Hanoi&lt;/city&gt;
      &lt;/weat:getWeatherRequest&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</code></pre>

<p><strong>SOAP Response Example:</strong></p>
<pre><code>&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
   &lt;soap:Body&gt;
      &lt;getWeatherResponse xmlns="http://example.com/weather"&gt;
         &lt;cityName&gt;Hanoi&lt;/cityName&gt;
         &lt;temperature&gt;28.5&lt;/temperature&gt;
         &lt;humidity&gt;75&lt;/humidity&gt;
         &lt;description&gt;Nhiá»u mÃ¢y&lt;/description&gt;
         &lt;windSpeed&gt;15&lt;/windSpeed&gt;
         &lt;feelsLike&gt;30.2&lt;/feelsLike&gt;
         &lt;visibility&gt;10&lt;/visibility&gt;
         &lt;uvIndex&gt;0&lt;/uvIndex&gt;
         &lt;icon&gt;04d&lt;/icon&gt;
         &lt;error&gt;&lt;/error&gt;
      &lt;/getWeatherResponse&gt;
   &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</code></pre>

<p><strong>Frontend gá»i SOAP:</strong></p>
<ul>
    <li><strong>File:</strong> <code>Frontend/index.html</code></li>
    <li><strong>Function:</strong> <code>fetchWeatherViaSOAP(city)</code></li>
    <li><strong>Line:</strong> ~1160-1200</li>
</ul>

<h4>âœ… PhÆ°Æ¡ng thá»©c 2: REST API (JSON)</h4>
<p><strong>ğŸ“ Controller:</strong> <code>Backend/controllers/weatherController.js</code><br>
<strong>Class:</strong> <code>WeatherController</code></p>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><strong>Thá»i tiáº¿t hiá»‡n táº¡i</strong></p>
    <pre><code>GET /api/weather?city={cityName}

Response:
{
  "city": "Hanoi",
  "temp": "28.5",
  "humidity": 75,
  "description": "Nhiá»u mÃ¢y",
  "windSpeed": 15,
  "feelsLike": "30.2",
  "visibility": 10,
  "uvIndex": 0,
  "timestamp": "2025-10-11T10:30:00.000Z"
}</code></pre>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><strong>Dá»± bÃ¡o nhiá»u ngÃ y</strong></p>
    <pre><code>GET /api/weather/forecast?city={cityName}&days=5

Response:
{
  "city": "Hanoi",
  "current": { ... },
  "forecast": [
    {
      "date": "12/10/2025",
      "temp": { "min": 24, "max": 32 },
      "description": "Trá»i quang",
      "humidity": 70,
      "windSpeed": 12
    },
    ...
  ],
  "timestamp": "2025-10-11T10:30:00.000Z"
}</code></pre>
</div>

<div class="page-break"></div>

<h2 id="section-4">4. PHÃ‚N TÃCH Dá»® LIá»†U Báº¢N Äá»’</h2>

<h3>4.1 Nguá»“n láº¥y dá»¯ liá»‡u báº£n Ä‘á»“</h3>

<h4>ğŸ“ File nguá»“n</h4>
<p><strong>File:</strong> <code>Backend/services/mapService.js</code><br>
<strong>Function:</strong> <code>getLocationLogic(cityName)</code></p>

<h4>ğŸŒ API sá»­ dá»¥ng</h4>
<div class="highlight">
    <p><strong>Provider:</strong> OpenWeatherMap Geocoding API</p>
    <pre><code>GET https://api.openweathermap.org/geo/1.0/direct
Parameters:
- q: cityName
- limit: 1
- appid: API_KEY</code></pre>
</div>

<h4>ğŸ“Š Dá»¯ liá»‡u thu tháº­p Ä‘Æ°á»£c</h4>
<table>
    <thead>
        <tr>
            <th>TrÆ°á»ng dá»¯ liá»‡u</th>
            <th>MÃ´ táº£</th>
            <th>Kiá»ƒu dá»¯ liá»‡u</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>cityName</code></td>
            <td>TÃªn thÃ nh phá»‘ chÃ­nh thá»©c</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>country</code></td>
            <td>MÃ£ quá»‘c gia (VN, US, JP...)</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>state</code></td>
            <td>Bang/Tá»‰nh/VÃ¹ng</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>latitude</code></td>
            <td>VÄ© Ä‘á»™</td>
            <td>Float (6 chá»¯ sá»‘ tháº­p phÃ¢n)</td>
        </tr>
        <tr>
            <td><code>longitude</code></td>
            <td>Kinh Ä‘á»™</td>
            <td>Float (6 chá»¯ sá»‘ tháº­p phÃ¢n)</td>
        </tr>
        <tr>
            <td><code>mapUrl</code></td>
            <td>URL OpenStreetMap interactive</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>streetMapUrl</code></td>
            <td>URL Google Maps street view</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>satelliteMapUrl</code></td>
            <td>URL Google Maps satellite</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>timezone</code></td>
            <td>TÃªn mÃºi giá»</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>timezoneOffset</code></td>
            <td>Offset mÃºi giá»</td>
            <td>Integer</td>
        </tr>
    </tbody>
</table>

<h3>4.2 Hiá»ƒn thá»‹ báº£n Ä‘á»“ trÃªn Frontend</h3>
<p><strong>ğŸ“ File:</strong> <code>Frontend/index.html</code></p>
<p><strong>Functions:</strong></p>
<ul>
    <li><code>displayMap(city)</code> - Láº¥y dá»¯ liá»‡u vÃ  hiá»ƒn thá»‹ map (Line ~1390)</li>
    <li><code>renderMap(locationData)</code> - Render iframe báº£n Ä‘á»“ (Line ~1450)</li>
    <li><code>switchMapType(type)</code> - Chuyá»ƒn Ä‘á»•i giá»¯a OpenStreetMap vÃ  Google Maps</li>
</ul>

<div class="summary-box">
    <h4>CÃ¡c loáº¡i báº£n Ä‘á»“:</h4>
    <ol>
        <li><strong>OpenStreetMap</strong> (Máº·c Ä‘á»‹nh)
            <ul>
                <li>Embed iframe tá»« openstreetmap.org</li>
                <li>Hiá»ƒn thá»‹ marker táº¡i tá»a Ä‘á»™ thÃ nh phá»‘</li>
            </ul>
        </li>
        <li><strong>Google Maps Satellite</strong>
            <ul>
                <li>Embed iframe Google Maps vá»›i layer satellite</li>
                <li>Toggle báº±ng button "ğŸ›°ï¸ Satellite"</li>
            </ul>
        </li>
    </ol>
</div>

<div class="page-break"></div>

<h2 id="section-5">5. PHÃ‚N TÃCH CHá»¨C NÄ‚NG CHAT AI</h2>

<h3>5.1 Kiáº¿n trÃºc Chat System</h3>
<div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INPUT                            â”‚
â”‚  - Text message                                         â”‚
â”‚  - Image upload (optional)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FRONTEND (index.html)                       â”‚
â”‚  - sendMessage()                                        â”‚
â”‚  - generateAIResponse() / sendMessageWithImage()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         BACKEND CHAT CONTROLLER                          â”‚
â”‚  controllers/chatController.js                          â”‚
â”‚  - handleChat() - text chat                             â”‚
â”‚  - handleChatWithImage() - image chat                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                        â”‚
         â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Weather Service  â”‚                   â”‚  Gemini Service  â”‚
â”‚ (if city found)  â”‚                   â”‚  - askGemini()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  - analyzeImage()â”‚
         â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  AI Response â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
</div>

<h3>5.2 AI Service (Gemini)</h3>

<div class="highlight">
    <h4>ğŸ“ Service File</h4>
    <p><strong>File:</strong> <code>Backend/services/geminiService.js</code><br>
    <strong>Class:</strong> <code>GeminiService</code></p>

    <h4>ğŸ¤– AI Model</h4>
    <ul>
        <li><strong>Provider:</strong> Google Generative AI</li>
        <li><strong>Model:</strong> <code>gemini-2.0-flash</code></li>
        <li><strong>API Key:</strong> <code>GEMINI_API_KEY</code> (trong <code>.env</code>)</li>
    </ul>
</div>

<h4>âš™ï¸ Configuration</h4>
<pre><code>generationConfig: {
    temperature: 0.7,      // Äá»™ sÃ¡ng táº¡o
    topK: 40,             // Top K sampling
    topP: 0.95,           // Top P sampling
    maxOutputTokens: 1024 // Max tokens per response
}</code></pre>

<h4>ğŸ”§ Methods</h4>
<table>
    <thead>
        <tr>
            <th>Method</th>
            <th>Chá»©c nÄƒng</th>
            <th>Input</th>
            <th>Output</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>init()</code></td>
            <td>Khá»Ÿi táº¡o service</td>
            <td>-</td>
            <td>void</td>
        </tr>
        <tr>
            <td><code>askGemini()</code></td>
            <td>Chat text</td>
            <td>prompt string</td>
            <td>AI response text</td>
        </tr>
        <tr>
            <td><code>analyzeWeatherImage()</code></td>
            <td>PhÃ¢n tÃ­ch áº£nh</td>
            <td>buffer, mimetype, prompt</td>
            <td>AI analysis text</td>
        </tr>
        <tr>
            <td><code>chatWithContext()</code></td>
            <td>Chat vá»›i lá»‹ch sá»­</td>
            <td>messages array</td>
            <td>AI response</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h3>5.3 CÃ¡ch tráº£ vá» káº¿t quáº£ Chat</h3>

<h4>âœ… REST API Endpoints</h4>

<div class="endpoint">
    <p><span class="endpoint-method method-post">POST</span><strong>Chat thÃ´ng thÆ°á»ng</strong></p>
    <pre><code>POST /api/chat
POST /chat (legacy route)

Request Body:
{
  "message": "Thá»i tiáº¿t HÃ  Ná»™i hÃ´m nay tháº¿ nÃ o?"
}

Response:
{
  "reply": "HÃ  Ná»™i hÃ´m nay trá»i nhiá»u mÃ¢y, nhiá»‡t Ä‘á»™ khoáº£ng 28Â°C..."
}</code></pre>
    <p><strong>Frontend gá»i:</strong> <code>generateAIResponse(message)</code> (Line ~1550)</p>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-post">POST</span><strong>Chat vá»›i áº£nh</strong></p>
    <pre><code>POST /api/chat/image

Request: FormData
- image: File (image file)
- message: String (optional)
- location: String (optional)

Response:
{
  "reply": "Tá»« áº£nh báº¡n gá»­i, tÃ´i tháº¥y trá»i Ä‘ang cÃ³ mÃ¢y Ä‘en..."
}</code></pre>
    <p><strong>Frontend gá»i:</strong> <code>sendMessageWithImage(message, imageFile)</code> (Line ~1710)</p>
</div>

<h3>5.4 TÃ­nh nÄƒng Ä‘áº·c biá»‡t cá»§a Chat</h3>

<div class="summary-box">
    <h4>ğŸ“¸ Image Upload Features</h4>
    <ul class="feature-list">
        <li><strong>Drag & Drop:</strong> KÃ©o tháº£ áº£nh vÃ o trang web</li>
        <li><strong>File picker:</strong> Click button Ä‘á»ƒ chá»n file</li>
        <li><strong>Preview:</strong> Xem trÆ°á»›c áº£nh trÆ°á»›c khi gá»­i</li>
        <li><strong>Lightbox:</strong> Click áº£nh Ä‘á»ƒ phÃ³ng to</li>
        <li><strong>Supported formats:</strong> JPG, PNG, GIF, WebP</li>
        <li><strong>Max size:</strong> 10MB</li>
    </ul>
</div>

<div class="warning-box">
    <h4>ğŸ” Google Search Integration</h4>
    <p><strong>File:</strong> <code>Backend/services/googleSearchService.js</code></p>
    <p><strong>KÃ­ch hoáº¡t khi:</strong></p>
    <ul>
        <li>Message chá»©a: "tin tá»©c", "má»›i nháº¥t", "hÃ´m nay", "tÃ¬m kiáº¿m"</li>
        <li>CÃ¢u há»i phá»©c táº¡p cáº§n thÃ´ng tin real-time</li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="section-6">6. Cáº¤U TRÃšC THÆ¯ Má»¤C</h2>

<div class="diagram">
<pre>
DuAnSOAP/
â”‚
â”œâ”€â”€ Backend/                          # Backend Node.js
â”‚   â”œâ”€â”€ server.js                    # Main server (102 lines)
â”‚   â”œâ”€â”€ config.js                    # Configuration
â”‚   â”œâ”€â”€ package.json                 # Dependencies
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/                 # Request handlers
â”‚   â”‚   â”œâ”€â”€ chatController.js       # Chat logic (405 lines)
â”‚   â”‚   â”œâ”€â”€ weatherController.js    # Weather logic (133 lines)
â”‚   â”‚   â””â”€â”€ imageWeatherController.js
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                    # Business logic
â”‚   â”‚   â”œâ”€â”€ geminiService.js        # Gemini AI (257 lines)
â”‚   â”‚   â”œâ”€â”€ mapService.js           # Map service (103 lines)
â”‚   â”‚   â””â”€â”€ googleSearchService.js  # Search integration
â”‚   â”‚
â”‚   â”œâ”€â”€ soap/                        # SOAP service
â”‚   â”‚   â”œâ”€â”€ weatherService.js       # SOAP ops (200 lines)
â”‚   â”‚   â””â”€â”€ weatherWsdl.xml         # WSDL definition
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/                  # Express middleware
â”‚   â”‚   â”œâ”€â”€ index.js                # Middleware setup
â”‚   â”‚   â””â”€â”€ upload.js               # Image upload
â”‚   â”‚
â”‚   â””â”€â”€ routes/                      # API routes
â”‚       â””â”€â”€ index.js                # Routes (104 lines)
â”‚
â”œâ”€â”€ Frontend/                         # Frontend HTML/CSS/JS
â”‚   â”œâ”€â”€ index.html                   # Main page (1925 lines)
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ map.css
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ map-service.js
â”‚   â””â”€â”€ img/                         # Images
â”‚
â”œâ”€â”€ docker-compose.yml                # Docker config
â”œâ”€â”€ Dockerfile                        # Docker image
â””â”€â”€ README.md                         # Documentation
</pre>
</div>

<div class="page-break"></div>

<h2 id="section-7">7. API ENDPOINTS</h2>

<h3>7.1 REST API Endpoints</h3>

<h4>ğŸ”¹ Weather APIs</h4>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><code>/api/weather?city={cityName}</code></p>
    <p><strong>Description:</strong> Láº¥y thá»i tiáº¿t hiá»‡n táº¡i cá»§a thÃ nh phá»‘</p>
    <p><strong>Controller:</strong> <code>weatherController.getWeatherJSON()</code></p>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><code>/api/weather/forecast?city={cityName}&days={number}</code></p>
    <p><strong>Description:</strong> Láº¥y dá»± bÃ¡o thá»i tiáº¿t nhiá»u ngÃ y (1-7 ngÃ y)</p>
    <p><strong>Controller:</strong> <code>weatherController.getForecast()</code></p>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><code>/api/weather/cities</code></p>
    <p><strong>Description:</strong> Láº¥y danh sÃ¡ch thÃ nh phá»‘ Ä‘Æ°á»£c há»— trá»£</p>
    <p><strong>Controller:</strong> <code>weatherController.getSupportedCities()</code></p>
</div>

<h4>ğŸ”¹ Chat APIs</h4>

<div class="endpoint">
    <p><span class="endpoint-method method-post">POST</span><code>/api/chat</code> hoáº·c <code>/chat</code></p>
    <p><strong>Description:</strong> Chat vá»›i AI bot</p>
    <p><strong>Request:</strong> <code>{ "message": "string" }</code></p>
    <p><strong>Response:</strong> <code>{ "reply": "string" }</code></p>
    <p><strong>Controller:</strong> <code>chatController.handleChat()</code></p>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-post">POST</span><code>/api/chat/image</code></p>
    <p><strong>Description:</strong> Chat vá»›i áº£nh thá»i tiáº¿t</p>
    <p><strong>Request:</strong> FormData with 'image', 'message', 'location'</p>
    <p><strong>Response:</strong> <code>{ "reply": "string" }</code></p>
    <p><strong>Controller:</strong> <code>chatController.handleChatWithImage()</code></p>
</div>

<h3>7.2 SOAP Service</h3>

<div class="endpoint">
    <p><strong>WSDL:</strong> <code>GET http://localhost:3000/weather?wsdl</code></p>
    <p><strong>Operations:</strong></p>
    <ul>
        <li><code>getWeather</code> - Láº¥y thÃ´ng tin thá»i tiáº¿t</li>
        <li><code>getLocation</code> - Láº¥y thÃ´ng tin báº£n Ä‘á»“</li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="section-8">8. CÃ”NG NGHá»† Sá»¬ Dá»¤NG</h2>

<h3>8.1 Backend Technologies</h3>
<table>
    <thead>
        <tr>
            <th>CÃ´ng nghá»‡</th>
            <th>Version</th>
            <th>Má»¥c Ä‘Ã­ch sá»­ dá»¥ng</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Node.js</strong></td>
            <td>Latest</td>
            <td>JavaScript runtime</td>
        </tr>
        <tr>
            <td><strong>Express.js</strong></td>
            <td>4.x</td>
            <td>Web framework</td>
        </tr>
        <tr>
            <td><strong>soap</strong></td>
            <td>Latest</td>
            <td>SOAP service implementation</td>
        </tr>
        <tr>
            <td><strong>axios</strong></td>
            <td>Latest</td>
            <td>HTTP client cho API calls</td>
        </tr>
        <tr>
            <td><strong>@google/generative-ai</strong></td>
            <td>Latest</td>
            <td>Google Gemini AI SDK</td>
        </tr>
        <tr>
            <td><strong>multer</strong></td>
            <td>Latest</td>
            <td>File upload handling</td>
        </tr>
        <tr>
            <td><strong>dotenv</strong></td>
            <td>Latest</td>
            <td>Environment variables</td>
        </tr>
        <tr>
            <td><strong>cors</strong></td>
            <td>Latest</td>
            <td>Cross-origin resource sharing</td>
        </tr>
    </tbody>
</table>

<h3>8.2 Frontend Technologies</h3>
<table>
    <thead>
        <tr>
            <th>CÃ´ng nghá»‡</th>
            <th>Má»¥c Ä‘Ã­ch</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>HTML5</strong></td>
            <td>Markup language</td>
        </tr>
        <tr>
            <td><strong>CSS3</strong></td>
            <td>Styling (gradient, animation, flexbox, grid)</td>
        </tr>
        <tr>
            <td><strong>Vanilla JavaScript</strong></td>
            <td>Client-side logic</td>
        </tr>
        <tr>
            <td><strong>Fetch API</strong></td>
            <td>AJAX requests</td>
        </tr>
        <tr>
            <td><strong>DOMParser</strong></td>
            <td>XML parsing (SOAP responses)</td>
        </tr>
        <tr>
            <td><strong>FormData API</strong></td>
            <td>File upload</td>
        </tr>
        <tr>
            <td><strong>Drag & Drop API</strong></td>
            <td>Image upload UX</td>
        </tr>
    </tbody>
</table>

<h3>8.3 External APIs</h3>
<table>
    <thead>
        <tr>
            <th>API</th>
            <th>Provider</th>
            <th>Purpose</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Weather API</strong></td>
            <td>OpenWeatherMap</td>
            <td>Current weather, forecast</td>
        </tr>
        <tr>
            <td><strong>Geocoding API</strong></td>
            <td>OpenWeatherMap</td>
            <td>City coordinates</td>
        </tr>
        <tr>
            <td><strong>Gemini AI</strong></td>
            <td>Google</td>
            <td>Text generation, image analysis</td>
        </tr>
        <tr>
            <td><strong>OpenStreetMap</strong></td>
            <td>OSM</td>
            <td>Map iframe</td>
        </tr>
        <tr>
            <td><strong>Google Maps</strong></td>
            <td>Google</td>
            <td>Map iframe, satellite view</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h2 id="section-9">9. SÆ  Äá»’ LUá»’NG Dá»® LIá»†U CHI TIáº¾T</h2>

<h3>9.1 Luá»“ng láº¥y thá»i tiáº¿t (SOAP)</h3>
<div class="diagram">
<pre>
User Input "Hanoi"
       â”‚
       â–¼
Frontend: getWeather()
       â”‚
       â–¼
fetchWeatherViaSOAP()
Create SOAP XML request
       â”‚
       â–¼
POST http://localhost:3000/weather
       â”‚
       â–¼
Backend SOAP Service
weatherService.js
       â”‚
       â–¼
getWeatherLogic(city)
       â”‚
       â–¼
Call OpenWeatherMap API
1. Current Weather API
2. Forecast API
       â”‚
       â–¼
Parse & format response
       â”‚
       â–¼
Wrap in SOAP XML
       â”‚
       â–¼
Frontend: parse XML
       â”‚
       â–¼
displayWeather(data)
Update DOM
</pre>
</div>

<h3>9.2 Luá»“ng chat vá»›i AI</h3>
<div class="diagram">
<pre>
User types message
       â”‚
       â–¼
Frontend: sendMessage()
       â”‚
       â–¼
POST /chat with message
       â”‚
       â–¼
chatController.handleChat()
       â”‚
       â”œâ”€â”€â†’ findCityInMessage()
       â”‚    Found: "HÃ  Ná»™i"
       â”‚         â”‚
       â”‚         â–¼
       â”‚    getWeatherLogic("HÃ  Ná»™i")
       â”‚    weatherData = {...}
       â”‚
       â”œâ”€â”€â†’ needsGoogleSearch()
       â”‚    Check keywords
       â”‚
       â–¼
createAIPrompt()
Combine: message + weather + search
       â”‚
       â–¼
geminiService.askGemini(prompt)
       â”‚
       â–¼
Call Gemini AI API
Model: gemini-2.0-flash
       â”‚
       â–¼
AI processes & generates response
       â”‚
       â–¼
Return to controller
       â”‚
       â–¼
Frontend receives response
       â”‚
       â–¼
Display in chatbox
</pre>
</div>

<div class="page-break"></div>

<h2 id="section-10">10. Káº¾T LUáº¬N</h2>

<h3>10.1 Äiá»ƒm máº¡nh cá»§a dá»± Ã¡n</h3>
<div class="summary-box">
    <ul class="feature-list">
        <li><strong>Kiáº¿n trÃºc hybrid SOAP + REST</strong> - Thá»ƒ hiá»‡n hiá»ƒu biáº¿t vá» cáº£ kiáº¿n trÃºc cÅ© vÃ  má»›i</li>
        <li><strong>TÃ­ch há»£p AI hiá»‡n Ä‘áº¡i</strong> - Sá»­ dá»¥ng Google Gemini 2.0 Flash</li>
        <li><strong>PhÃ¢n tÃ­ch áº£nh thÃ´ng minh</strong> - Gemini Vision cho weather image analysis</li>
        <li><strong>UI/UX Ä‘áº¹p</strong> - Gradient animation, responsive, smooth transitions</li>
        <li><strong>Code structure tá»‘t</strong> - Separation of concerns (controllers, services, routes)</li>
        <li><strong>Error handling</strong> - Try-catch blocks, validation middleware</li>
        <li><strong>Multiple data sources</strong> - Weather API + Geocoding + AI</li>
        <li><strong>Interactive map</strong> - Multiple map providers, switch between types</li>
    </ul>
</div>

<h3>10.2 Äiá»ƒm cÃ³ thá»ƒ cáº£i thiá»‡n</h3>
<div class="warning-box">
    <ul>
        <li>ğŸ”¸ <strong>Caching</strong> - Implement Redis/memory cache cho weather data</li>
        <li>ğŸ”¸ <strong>Rate limiting</strong> - Protect APIs from abuse</li>
        <li>ğŸ”¸ <strong>Authentication</strong> - Add user authentication cho advanced features</li>
        <li>ğŸ”¸ <strong>Database</strong> - Store chat history, favorite cities</li>
        <li>ğŸ”¸ <strong>Testing</strong> - Unit tests, integration tests</li>
        <li>ğŸ”¸ <strong>Logging</strong> - Structured logging (Winston, Morgan)</li>
        <li>ğŸ”¸ <strong>API documentation</strong> - Swagger/OpenAPI docs</li>
        <li>ğŸ”¸ <strong>i18n</strong> - Multi-language support</li>
    </ul>
</div>

<h3>10.3 Tech Stack Summary</h3>
<div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          FRONTEND                   â”‚
â”‚  HTML5 + CSS3 + Vanilla JS          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          BACKEND                    â”‚
â”‚  Node.js + Express.js               â”‚
â”‚  SOAP Service (node-soap)           â”‚
â”‚  REST API                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
          â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ External APIsâ”‚  â”‚ AI Service  â”‚
â”‚ OpenWeather  â”‚  â”‚ Gemini 2.0  â”‚
â”‚ Google Maps  â”‚  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
</div>

<div class="page-break"></div>

<h2>PHá»¤ Lá»¤C</h2>

<h3>A. Environment Variables</h3>
<pre><code># Server
PORT=3000
NODE_ENV=development

# APIs
OPENWEATHER_API_KEY=your_openweather_api_key
GEMINI_API_KEY=your_gemini_api_key
GOOGLE_SEARCH_API_KEY=your_google_search_key (optional)
GOOGLE_SEARCH_CX=your_custom_search_engine_id (optional)
</code></pre>

<h3>B. Installation & Run</h3>
<pre><code># Install dependencies
cd Backend
npm install

# Create .env file
cp .env.example .env
# Edit .env with your API keys

# Run server
npm start

# Server will be available at:
# http://localhost:3000
</code></pre>

<h3>C. Docker Deployment</h3>
<pre><code># Build and run with Docker Compose
docker-compose up -d

# View logs
docker-compose logs -f

# Stop
docker-compose down
</code></pre>

<hr>

<div style="text-align: center; margin-top: 50px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
    <p><strong>TÃ i liá»‡u Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng tá»« phÃ¢n tÃ­ch mÃ£ nguá»“n</strong></p>
    <p><strong>Repository:</strong> DuAN_TroLyThoiThiet_TraMy</p>
    <p><strong>Owner:</strong> KyThuatTVU</p>
    <p><strong>NgÃ y:</strong> 11/10/2025</p>
    <p><strong>PhiÃªn báº£n:</strong> 1.0</p>
</div>

</div>

<script>
    // Export to PDF function using browser's print to PDF
    function exportToPDF() {
        const button = document.getElementById('pdf-text');
        const originalText = button.textContent;
        
        // Show loading
        button.innerHTML = '<span class="loading-spinner"></span> Äang chuáº©n bá»‹...';
        
        setTimeout(() => {
            button.textContent = originalText;
            
            // Hide export buttons before printing
            const exportButtons = document.querySelector('.export-buttons');
            exportButtons.style.display = 'none';
            
            // Trigger print dialog
            window.print();
            
            // Show buttons again after print dialog
            setTimeout(() => {
                exportButtons.style.display = 'flex';
                alert('ğŸ’¡ HÆ°á»›ng dáº«n:\n\n1. Trong há»™p thoáº¡i In, chá»n "Destination" â†’ "Save as PDF"\n2. Nháº¥n "Save" Ä‘á»ƒ lÆ°u file PDF\n\nâœ… File PDF sáº½ giá»¯ nguyÃªn mÃ u sáº¯c vÃ  Ä‘á»‹nh dáº¡ng Ä‘áº¹p!');
            }, 500);
        }, 300);
    }
    
    // Export to Word function
    function exportToWord() {
        // Show loading message
        alert('ğŸ”„ Äang chuáº©n bá»‹ file Word...\n\nVui lÃ²ng chá» trong giÃ¢y lÃ¡t!');
        
        try {
            // Get the content
            const content = document.getElementById('content');
            const htmlContent = content.innerHTML;
            
            // Create a complete HTML document for Word with proper encoding
            const preHtml = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                      xmlns:w='urn:schemas-microsoft-com:office:word' 
                      xmlns='http://www.w3.org/TR/REC-html40'>
                <head>
                    <meta charset='utf-8'>
                    <title>PhÃ¢n TÃ­ch Dá»± Ãn - Trá»£ LÃ½ Thá»i Tiáº¿t TrÃ  My AI</title>
                    <!--[if gte mso 9]>
                    <xml>
                        <w:WordDocument>
                            <w:View>Print</w:View>
                            <w:Zoom>100</w:Zoom>
                            <w:DoNotOptimizeForBrowser/>
                        </w:WordDocument>
                    </xml>
                    <![endif]-->
                    <style>
                        body { 
                            font-family: 'Segoe UI', 'Calibri', Arial, sans-serif; 
                            line-height: 1.6;
                            max-width: 21cm;
                            margin: 2cm auto;
                            color: #333;
                        }
                        h1 { 
                            color: #2c3e50; 
                            border-bottom: 3px solid #3498db; 
                            padding-bottom: 10px;
                            text-align: center;
                            font-size: 28pt;
                        }
                        h2 { 
                            color: #34495e; 
                            border-bottom: 2px solid #95a5a6; 
                            padding-bottom: 8px; 
                            margin-top: 30px;
                            font-size: 20pt;
                        }
                        h3 { 
                            color: #2980b9; 
                            margin-top: 20px;
                            font-size: 16pt;
                        }
                        h4 {
                            color: #16a085;
                            font-size: 14pt;
                        }
                        pre { 
                            background: #2c3e50; 
                            color: #ecf0f1; 
                            padding: 15px; 
                            border-radius: 5px;
                            font-family: 'Courier New', monospace;
                            white-space: pre-wrap;
                            word-wrap: break-word;
                        }
                        code {
                            background: #ecf0f1;
                            padding: 2px 6px;
                            border-radius: 3px;
                            font-family: 'Courier New', monospace;
                            color: #e74c3c;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin: 20px 0;
                        }
                        th { 
                            background: #3498db; 
                            color: white; 
                            padding: 12px; 
                            text-align: left;
                            font-weight: bold;
                        }
                        td { 
                            padding: 10px; 
                            border: 1px solid #ddd;
                        }
                        tr:nth-child(even) {
                            background: #f8f9fa;
                        }
                        .diagram { 
                            background: #f8f9fa; 
                            padding: 20px; 
                            border: 2px solid #3498db;
                            border-radius: 5px;
                            font-family: monospace;
                        }
                        .metadata {
                            text-align: center;
                            background: #ecf0f1;
                            padding: 15px;
                            border-radius: 5px;
                            margin-bottom: 30px;
                        }
                        .toc {
                            background: #f8f9fa;
                            padding: 20px;
                            border-left: 4px solid #3498db;
                            margin: 30px 0;
                        }
                        .summary-box {
                            background: #e8f5e9;
                            border: 2px solid #4caf50;
                            border-radius: 8px;
                            padding: 20px;
                            margin: 20px 0;
                        }
                        .warning-box {
                            background: #fff3e0;
                            border: 2px solid #ff9800;
                            border-radius: 8px;
                            padding: 20px;
                            margin: 20px 0;
                        }
                        .highlight {
                            background: #fff3cd;
                            padding: 15px;
                            border-left: 4px solid #ffc107;
                            margin: 20px 0;
                        }
                        .endpoint {
                            background: #f1f8ff;
                            border: 1px solid #c8e1ff;
                            border-radius: 5px;
                            padding: 15px;
                            margin: 15px 0;
                        }
                        .feature-list {
                            list-style: none;
                            padding-left: 0;
                        }
                        .feature-list li {
                            padding: 8px 0;
                            padding-left: 30px;
                        }
                        ul {
                            padding-left: 20px;
                        }
                        li {
                            margin: 5px 0;
                        }
                    </style>
                </head>
                <body>`;
            
            const postHtml = `</body></html>`;
            
            const fullHtml = preHtml + htmlContent + postHtml;
            
            // Method 1: Try using Blob and download link
            try {
                // Create blob with BOM for UTF-8
                const blob = new Blob(['\ufeff', fullHtml], {
                    type: 'application/msword;charset=utf-8'
                });
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'PhanTich_DuAn_TraMy_AI.doc';
                link.style.display = 'none';
                
                // Add to DOM and trigger download
                document.body.appendChild(link);
                link.click();
                
                // Cleanup
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                // Show success message
                setTimeout(() => {
                    alert('âœ… ÄÃ£ xuáº¥t file Word thÃ nh cÃ´ng!\n\nğŸ“ TÃªn file: PhanTich_DuAn_TraMy_AI.doc\n\nğŸ’¡ Má»Ÿ file báº±ng Microsoft Word Ä‘á»ƒ xem vá»›i Ä‘á»‹nh dáº¡ng Ä‘áº¹p.');
                }, 500);
                
            } catch (blobError) {
                // Method 2: Fallback to window.open
                console.warn('Blob method failed, trying window.open:', blobError);
                
                // Create a data URL
                const dataUrl = 'data:application/msword;charset=utf-8,' + encodeURIComponent('\ufeff' + fullHtml);
                
                // Open in new window/tab
                const newWindow = window.open(dataUrl, '_blank');
                
                if (!newWindow) {
                    throw new Error('Popup blocked. Please allow popups for this site.');
                }
                
                // Show instructions
                setTimeout(() => {
                    alert('ğŸ“„ File Word Ä‘Ã£ má»Ÿ trong tab má»›i!\n\nğŸ’¡ Äá»ƒ lÆ°u file:\n1. Nháº¥n Ctrl+S (hoáº·c Cmd+S trÃªn Mac)\n2. Chá»n nÆ¡i lÆ°u vÃ  Ä‘áº·t tÃªn: PhanTich_DuAn_TraMy_AI.doc\n3. Nháº¥n Save');
                }, 1000);
            }
            
        } catch (error) {
            alert('âŒ Lá»—i khi xuáº¥t Word: ' + error.message + '\n\nğŸ’¡ Thá»­ cÃ¡ch khÃ¡c:\n1. Nháº¥n Ctrl+P Ä‘á»ƒ in\n2. Chá»n "Save as PDF" Ä‘á»ƒ lÆ°u PDF\n3. Hoáº·c copy ná»™i dung vÃ  paste vÃ o Word');
        }
    }
    
    // Print function
    function printDocument() {
        // Hide export buttons before printing
        const exportButtons = document.querySelector('.export-buttons');
        exportButtons.style.display = 'none';
        
        // Trigger print dialog
        window.print();
        
        // Show buttons again after print dialog closes
        setTimeout(() => {
            exportButtons.style.display = 'flex';
        }, 500);
    }
    
    // Handle print media query events
    if (window.matchMedia) {
        const mediaQueryList = window.matchMedia('print');
        mediaQueryList.addListener(function(mql) {
            const exportButtons = document.querySelector('.export-buttons');
            if (mql.matches) {
                // Before print
                exportButtons.style.display = 'none';
            } else {
                // After print
                exportButtons.style.display = 'flex';
            }
        });
    }
</script>

</body>
</html>
