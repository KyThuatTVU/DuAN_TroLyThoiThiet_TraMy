<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n T√≠ch D·ª± √Ån - Tr·ª£ L√Ω Th·ªùi Ti·∫øt Tr√† My AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @page {
            margin: 2cm;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            font-size: 2.5em;
            text-align: center;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 30px;
            font-size: 1.8em;
        }
        
        h3 {
            color: #2980b9;
            margin-top: 20px;
            font-size: 1.4em;
        }
        
        h4 {
            color: #16a085;
            margin-top: 15px;
            font-size: 1.2em;
        }
        
        .metadata {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 30px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        
        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-left: 4px solid #3498db;
            margin: 30px 0;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .toc a {
            color: #2980b9;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        code {
            background: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
            font-size: 0.9em;
        }
        
        pre code {
            background: transparent;
            color: #ecf0f1;
            padding: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        tr:hover {
            background: #e8f4f8;
        }
        
        .diagram {
            background: #f8f9fa;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            overflow-x: auto;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .feature-list li:before {
            content: "‚úÖ";
            position: absolute;
            left: 0;
        }
        
        .endpoint {
            background: #f1f8ff;
            border: 1px solid #c8e1ff;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .endpoint-method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 10px;
        }
        
        .method-get {
            background: #61affe;
            color: white;
        }
        
        .method-post {
            background: #49cc90;
            color: white;
        }
        
        .page-break {
            page-break-after: always;
        }
        
        .summary-box {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .warning-box {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        @media print {
            body {
                font-size: 11pt;
            }
            
            .page-break {
                page-break-after: always;
            }
            
            pre, .diagram {
                page-break-inside: avoid;
            }
            
            .export-buttons {
                display: none !important;
            }
        }
        
        /* Export Buttons Styling */
        .export-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            gap: 10px;
        }
        
        .export-btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .export-btn:active {
            transform: translateY(0);
        }
        
        .btn-pdf {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-word {
            background: linear-gradient(135deg, #2b5797, #1e3a5f);
            color: white;
        }
        
        .btn-print {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<!-- Export Buttons -->
<div class="export-buttons">
    <button class="export-btn btn-pdf" onclick="exportToPDF()">
        <span>üìÑ</span>
        <span id="pdf-text">Xu·∫•t PDF</span>
    </button>
    <button class="export-btn btn-word" onclick="exportToWord()">
        <span>üìù</span>
        <span>Xu·∫•t Word</span>
    </button>
    <button class="export-btn btn-print" onclick="printDocument()">
        <span>üñ®Ô∏è</span>
        <span>In</span>
    </button>
</div>

<div id="content">

<h1>üå§Ô∏è PH√ÇN T√çCH D·ª∞ √ÅN<br>TR·ª¢ L√ù TH·ªúI TI·∫æT TR√Ä MY AI</h1>

<div class="metadata">
    <p><strong>Ng√†y ph√¢n t√≠ch:</strong> 11/10/2025</p>
    <p><strong>D·ª± √°n:</strong> H·ªá th·ªëng tr·ª£ l√Ω th·ªùi ti·∫øt th√¥ng minh v·ªõi SOAP & REST API</p>
    <p><strong>Repository:</strong> DuAN_TroLyThoiThiet_TraMy</p>
    <p><strong>Owner:</strong> KyThuatTVU</p>
</div>

<div class="toc">
    <h2>üìã M·ª§C L·ª§C</h2>
    <ul>
        <li><a href="#section-1">1. T·ªïng quan d·ª± √°n</a></li>
        <li><a href="#section-2">2. Ki·∫øn tr√∫c h·ªá th·ªëng</a></li>
        <li><a href="#section-3">3. Ph√¢n t√≠ch d·ªØ li·ªáu th·ªùi ti·∫øt</a></li>
        <li><a href="#section-4">4. Ph√¢n t√≠ch d·ªØ li·ªáu b·∫£n ƒë·ªì</a></li>
        <li><a href="#section-5">5. Ph√¢n t√≠ch ch·ª©c nƒÉng chat AI</a></li>
        <li><a href="#section-6">6. C·∫•u tr√∫c th∆∞ m·ª•c</a></li>
        <li><a href="#section-7">7. API Endpoints</a></li>
        <li><a href="#section-8">8. C√¥ng ngh·ªá s·ª≠ d·ª•ng</a></li>
        <li><a href="#section-9">9. S∆° ƒë·ªì lu·ªìng d·ªØ li·ªáu chi ti·∫øt</a></li>
        <li><a href="#section-10">10. K·∫øt lu·∫≠n</a></li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="section-1">1. T·ªîNG QUAN D·ª∞ √ÅN</h2>

<h3>1.1 M√¥ t·∫£</h3>
<p>D·ª± √°n <strong>Tr·ª£ l√Ω th·ªùi ti·∫øt Tr√† My AI</strong> l√† m·ªôt ·ª©ng d·ª•ng web t√≠ch h·ª£p nhi·ªÅu c√¥ng ngh·ªá ƒë·ªÉ cung c·∫•p th√¥ng tin th·ªùi ti·∫øt th√¥ng minh, h·ªó tr·ª£:</p>
<ul class="feature-list">
    <li>Tra c·ª©u th·ªùi ti·∫øt theo th√†nh ph·ªë</li>
    <li>Hi·ªÉn th·ªã b·∫£n ƒë·ªì v·ªã tr√≠</li>
    <li>Chatbot AI v·ªõi kh·∫£ nƒÉng ph√¢n t√≠ch ·∫£nh th·ªùi ti·∫øt</li>
    <li>T√≠ch h·ª£p SOAP v√† REST API</li>
</ul>

<h3>1.2 T√≠nh nƒÉng ch√≠nh</h3>
<div class="summary-box">
    <ul class="feature-list">
        <li>Tra c·ª©u th·ªùi ti·∫øt hi·ªán t·∫°i v√† d·ª± b√°o</li>
        <li>Hi·ªÉn th·ªã b·∫£n ƒë·ªì t∆∞∆°ng t√°c (OpenStreetMap, Google Maps)</li>
        <li>Chat v·ªõi AI (Google Gemini 2.0)</li>
        <li>Ph√¢n t√≠ch ·∫£nh th·ªùi ti·∫øt b·∫±ng AI Vision</li>
        <li>Giao di·ªán ƒë·∫πp, responsive</li>
        <li>Drag & drop upload ·∫£nh</li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="section-2">2. KI·∫æN TR√öC H·ªÜ TH·ªêNG</h2>

<h3>2.1 S∆° ƒë·ªì ki·∫øn tr√∫c t·ªïng quan</h3>
<div class="diagram">
<pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FRONTEND (HTML/JS)                    ‚îÇ
‚îÇ              Frontend/index.html                         ‚îÇ
‚îÇ  - Giao di·ªán ng∆∞·ªùi d√πng                                 ‚îÇ
‚îÇ  - X·ª≠ l√Ω t∆∞∆°ng t√°c                                      ‚îÇ
‚îÇ  - G·ªçi API Backend                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  BACKEND (Node.js/Express)               ‚îÇ
‚îÇ                   Backend/server.js                      ‚îÇ
‚îÇ  - REST API Server                                      ‚îÇ
‚îÇ  - SOAP Service                                         ‚îÇ
‚îÇ  - Routing & Middleware                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                    ‚îÇ                    ‚îÇ
         ‚ñº                    ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Weather    ‚îÇ   ‚îÇ     Map      ‚îÇ   ‚îÇ  Chat AI     ‚îÇ
‚îÇ   Service    ‚îÇ   ‚îÇ   Service    ‚îÇ   ‚îÇ   Service    ‚îÇ
‚îÇ   (SOAP)     ‚îÇ   ‚îÇ   (SOAP)     ‚îÇ   ‚îÇ   (REST)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                    ‚îÇ                    ‚îÇ
         ‚ñº                    ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇOpenWeatherMap‚îÇ   ‚îÇOpenWeatherMap‚îÇ   ‚îÇ Google       ‚îÇ
‚îÇ Weather API  ‚îÇ   ‚îÇ Geocoding API‚îÇ   ‚îÇ Gemini AI    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</pre>
</div>

<h3>2.2 Ki·∫øn tr√∫c Backend</h3>
<div class="diagram">
<pre>
Backend/
‚îú‚îÄ‚îÄ server.js                    # Main server file
‚îú‚îÄ‚îÄ config.js                    # Configuration
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ index.js                # API routing
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ weatherController.js    # Weather logic
‚îÇ   ‚îú‚îÄ‚îÄ chatController.js       # Chat logic
‚îÇ   ‚îî‚îÄ‚îÄ imageWeatherController.js
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ geminiService.js        # AI service
‚îÇ   ‚îú‚îÄ‚îÄ mapService.js           # Map service
‚îÇ   ‚îî‚îÄ‚îÄ googleSearchService.js  # Search service
‚îú‚îÄ‚îÄ soap/
‚îÇ   ‚îú‚îÄ‚îÄ weatherService.js       # SOAP service
‚îÇ   ‚îî‚îÄ‚îÄ weatherWsdl.xml         # WSDL definition
‚îî‚îÄ‚îÄ middleware/
    ‚îú‚îÄ‚îÄ index.js                # Middleware setup
    ‚îî‚îÄ‚îÄ upload.js               # Image upload handler
</pre>
</div>

<div class="page-break"></div>

<h2 id="section-3">3. PH√ÇN T√çCH D·ªÆ LI·ªÜU TH·ªúI TI·∫æT</h2>

<h3>3.1 Ngu·ªìn l·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt</h3>

<h4>üìç File ngu·ªìn</h4>
<p><strong>File:</strong> <code>Backend/soap/weatherService.js</code><br>
<strong>Function:</strong> <code>getWeatherLogic(cityName)</code></p>

<h4>üåê API s·ª≠ d·ª•ng</h4>
<ul>
    <li><strong>Provider:</strong> OpenWeatherMap API</li>
    <li><strong>API Key:</strong> C·∫•u h√¨nh trong bi·∫øn <code>OPENWEATHER_API_KEY</code> (file <code>.env</code>)</li>
</ul>

<h4>üì° Endpoints g·ªçi</h4>
<div class="endpoint">
    <p><strong>1. Current Weather API</strong></p>
    <pre><code>GET https://api.openweathermap.org/data/2.5/weather
Parameters: 
- q: t√™n th√†nh ph·ªë
- appid: API key
- units: metric (Celsius)
- lang: vi (Ti·∫øng Vi·ªát)</code></pre>
</div>

<div class="endpoint">
    <p><strong>2. Forecast API</strong> (d·ª± b√°o 5 ng√†y)</p>
    <pre><code>GET https://api.openweathermap.org/data/2.5/forecast
Parameters:
- lat, lon: t·ªça ƒë·ªô t·ª´ Current Weather API
- appid: API key
- units: metric
- lang: vi</code></pre>
</div>

<h4>üìä D·ªØ li·ªáu thu th·∫≠p ƒë∆∞·ª£c</h4>
<table>
    <thead>
        <tr>
            <th>Tr∆∞·ªùng d·ªØ li·ªáu</th>
            <th>M√¥ t·∫£</th>
            <th>ƒê∆°n v·ªã</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>temperature</code></td>
            <td>Nhi·ªát ƒë·ªô hi·ªán t·∫°i</td>
            <td>¬∞C</td>
        </tr>
        <tr>
            <td><code>humidity</code></td>
            <td>ƒê·ªô ·∫©m</td>
            <td>%</td>
        </tr>
        <tr>
            <td><code>description</code></td>
            <td>M√¥ t·∫£ th·ªùi ti·∫øt</td>
            <td>Text (Ti·∫øng Vi·ªát)</td>
        </tr>
        <tr>
            <td><code>windSpeed</code></td>
            <td>T·ªëc ƒë·ªô gi√≥</td>
            <td>km/h</td>
        </tr>
        <tr>
            <td><code>feelsLike</code></td>
            <td>C·∫£m gi√°c nh∆∞</td>
            <td>¬∞C</td>
        </tr>
        <tr>
            <td><code>visibility</code></td>
            <td>T·∫ßm nh√¨n</td>
            <td>km</td>
        </tr>
        <tr>
            <td><code>uvIndex</code></td>
            <td>Ch·ªâ s·ªë UV</td>
            <td>0-10</td>
        </tr>
        <tr>
            <td><code>cityName</code></td>
            <td>T√™n th√†nh ph·ªë</td>
            <td>Text</td>
        </tr>
        <tr>
            <td><code>icon</code></td>
            <td>M√£ icon th·ªùi ti·∫øt</td>
            <td>Code</td>
        </tr>
        <tr>
            <td><code>tempMax/tempMin</code></td>
            <td>Nhi·ªát ƒë·ªô cao nh·∫•t/th·∫•p nh·∫•t</td>
            <td>¬∞C</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h3>3.2 C√°ch tr·∫£ v·ªÅ k·∫øt qu·∫£ th·ªùi ti·∫øt</h3>

<h4>‚úÖ Ph∆∞∆°ng th·ª©c 1: SOAP Service</h4>
<div class="highlight">
    <p><strong>üìç Location:</strong> <code>Backend/soap/weatherService.js</code><br>
    <strong>Function:</strong> <code>weatherServiceDefinition.WeatherService.WeatherPort.getWeather()</code></p>
    <p><strong>Endpoint:</strong> <code>POST http://localhost:3000/weather</code><br>
    <strong>Protocol:</strong> SOAP 1.1<br>
    <strong>Content-Type:</strong> <code>text/xml</code></p>
</div>

<p><strong>SOAP Request Example:</strong></p>
<pre><code>&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" 
                  xmlns:weat="http://example.com/weather"&gt;
   &lt;soapenv:Header/&gt;
   &lt;soapenv:Body&gt;
      &lt;weat:getWeatherRequest&gt;
         &lt;city&gt;Hanoi&lt;/city&gt;
      &lt;/weat:getWeatherRequest&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</code></pre>

<p><strong>SOAP Response Example:</strong></p>
<pre><code>&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
   &lt;soap:Body&gt;
      &lt;getWeatherResponse xmlns="http://example.com/weather"&gt;
         &lt;cityName&gt;Hanoi&lt;/cityName&gt;
         &lt;temperature&gt;28.5&lt;/temperature&gt;
         &lt;humidity&gt;75&lt;/humidity&gt;
         &lt;description&gt;Nhi·ªÅu m√¢y&lt;/description&gt;
         &lt;windSpeed&gt;15&lt;/windSpeed&gt;
         &lt;feelsLike&gt;30.2&lt;/feelsLike&gt;
         &lt;visibility&gt;10&lt;/visibility&gt;
         &lt;uvIndex&gt;0&lt;/uvIndex&gt;
         &lt;icon&gt;04d&lt;/icon&gt;
         &lt;error&gt;&lt;/error&gt;
      &lt;/getWeatherResponse&gt;
   &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</code></pre>

<p><strong>Frontend g·ªçi SOAP:</strong></p>
<ul>
    <li><strong>File:</strong> <code>Frontend/index.html</code></li>
    <li><strong>Function:</strong> <code>fetchWeatherViaSOAP(city)</code></li>
    <li><strong>Line:</strong> ~1160-1200</li>
</ul>

<h4>‚úÖ Ph∆∞∆°ng th·ª©c 2: REST API (JSON)</h4>
<p><strong>üìç Controller:</strong> <code>Backend/controllers/weatherController.js</code><br>
<strong>Class:</strong> <code>WeatherController</code></p>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><strong>Th·ªùi ti·∫øt hi·ªán t·∫°i</strong></p>
    <pre><code>GET /api/weather?city={cityName}

Response:
{
  "city": "Hanoi",
  "temp": "28.5",
  "humidity": 75,
  "description": "Nhi·ªÅu m√¢y",
  "windSpeed": 15,
  "feelsLike": "30.2",
  "visibility": 10,
  "uvIndex": 0,
  "timestamp": "2025-10-11T10:30:00.000Z"
}</code></pre>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><strong>D·ª± b√°o nhi·ªÅu ng√†y</strong></p>
    <pre><code>GET /api/weather/forecast?city={cityName}&days=5

Response:
{
  "city": "Hanoi",
  "current": { ... },
  "forecast": [
    {
      "date": "12/10/2025",
      "temp": { "min": 24, "max": 32 },
      "description": "Tr·ªùi quang",
      "humidity": 70,
      "windSpeed": 12
    },
    ...
  ],
  "timestamp": "2025-10-11T10:30:00.000Z"
}</code></pre>
</div>

<div class="page-break"></div>

<h2 id="section-4">4. PH√ÇN T√çCH D·ªÆ LI·ªÜU B·∫¢N ƒê·ªí</h2>

<h3>4.1 Ngu·ªìn l·∫•y d·ªØ li·ªáu b·∫£n ƒë·ªì</h3>

<h4>üìç File ngu·ªìn</h4>
<p><strong>File:</strong> <code>Backend/services/mapService.js</code><br>
<strong>Function:</strong> <code>getLocationLogic(cityName)</code></p>

<h4>üåê API s·ª≠ d·ª•ng</h4>
<div class="highlight">
    <p><strong>Provider:</strong> OpenWeatherMap Geocoding API</p>
    <pre><code>GET https://api.openweathermap.org/geo/1.0/direct
Parameters:
- q: cityName
- limit: 1
- appid: API_KEY</code></pre>
</div>

<h4>üìä D·ªØ li·ªáu thu th·∫≠p ƒë∆∞·ª£c</h4>
<table>
    <thead>
        <tr>
            <th>Tr∆∞·ªùng d·ªØ li·ªáu</th>
            <th>M√¥ t·∫£</th>
            <th>Ki·ªÉu d·ªØ li·ªáu</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>cityName</code></td>
            <td>T√™n th√†nh ph·ªë ch√≠nh th·ª©c</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>country</code></td>
            <td>M√£ qu·ªëc gia (VN, US, JP...)</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>state</code></td>
            <td>Bang/T·ªânh/V√πng</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>latitude</code></td>
            <td>Vƒ© ƒë·ªô</td>
            <td>Float (6 ch·ªØ s·ªë th·∫≠p ph√¢n)</td>
        </tr>
        <tr>
            <td><code>longitude</code></td>
            <td>Kinh ƒë·ªô</td>
            <td>Float (6 ch·ªØ s·ªë th·∫≠p ph√¢n)</td>
        </tr>
        <tr>
            <td><code>mapUrl</code></td>
            <td>URL OpenStreetMap interactive</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>streetMapUrl</code></td>
            <td>URL Google Maps street view</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>satelliteMapUrl</code></td>
            <td>URL Google Maps satellite</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>timezone</code></td>
            <td>T√™n m√∫i gi·ªù</td>
            <td>String</td>
        </tr>
        <tr>
            <td><code>timezoneOffset</code></td>
            <td>Offset m√∫i gi·ªù</td>
            <td>Integer</td>
        </tr>
    </tbody>
</table>

<h3>4.2 Hi·ªÉn th·ªã b·∫£n ƒë·ªì tr√™n Frontend</h3>
<p><strong>üìç File:</strong> <code>Frontend/index.html</code></p>
<p><strong>Functions:</strong></p>
<ul>
    <li><code>displayMap(city)</code> - L·∫•y d·ªØ li·ªáu v√† hi·ªÉn th·ªã map (Line ~1390)</li>
    <li><code>renderMap(locationData)</code> - Render iframe b·∫£n ƒë·ªì (Line ~1450)</li>
    <li><code>switchMapType(type)</code> - Chuy·ªÉn ƒë·ªïi gi·ªØa OpenStreetMap v√† Google Maps</li>
</ul>

<div class="summary-box">
    <h4>C√°c lo·∫°i b·∫£n ƒë·ªì:</h4>
    <ol>
        <li><strong>OpenStreetMap</strong> (M·∫∑c ƒë·ªãnh)
            <ul>
                <li>Embed iframe t·ª´ openstreetmap.org</li>
                <li>Hi·ªÉn th·ªã marker t·∫°i t·ªça ƒë·ªô th√†nh ph·ªë</li>
            </ul>
        </li>
        <li><strong>Google Maps Satellite</strong>
            <ul>
                <li>Embed iframe Google Maps v·ªõi layer satellite</li>
                <li>Toggle b·∫±ng button "üõ∞Ô∏è Satellite"</li>
            </ul>
        </li>
    </ol>
</div>

<div class="page-break"></div>

<h2 id="section-5">5. PH√ÇN T√çCH CH·ª®C NƒÇNG CHAT AI</h2>

<h3>5.1 Ki·∫øn tr√∫c Chat System</h3>
<div class="diagram">
<pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    USER INPUT                            ‚îÇ
‚îÇ  - Text message                                         ‚îÇ
‚îÇ  - Image upload (optional)                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              FRONTEND (index.html)                       ‚îÇ
‚îÇ  - sendMessage()                                        ‚îÇ
‚îÇ  - generateAIResponse() / sendMessageWithImage()        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         BACKEND CHAT CONTROLLER                          ‚îÇ
‚îÇ  controllers/chatController.js                          ‚îÇ
‚îÇ  - handleChat() - text chat                             ‚îÇ
‚îÇ  - handleChatWithImage() - image chat                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                                        ‚îÇ
         ‚ñº                                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Weather Service  ‚îÇ                   ‚îÇ  Gemini Service  ‚îÇ
‚îÇ (if city found)  ‚îÇ                   ‚îÇ  - askGemini()   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ  - analyzeImage()‚îÇ
         ‚îÇ                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  AI Response ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</pre>
</div>

<h3>5.2 AI Service (Gemini)</h3>

<div class="highlight">
    <h4>üìç Service File</h4>
    <p><strong>File:</strong> <code>Backend/services/geminiService.js</code><br>
    <strong>Class:</strong> <code>GeminiService</code></p>

    <h4>ü§ñ AI Model</h4>
    <ul>
        <li><strong>Provider:</strong> Google Generative AI</li>
        <li><strong>Model:</strong> <code>gemini-2.0-flash</code></li>
        <li><strong>API Key:</strong> <code>GEMINI_API_KEY</code> (trong <code>.env</code>)</li>
    </ul>
</div>

<h4>‚öôÔ∏è Configuration</h4>
<pre><code>generationConfig: {
    temperature: 0.7,      // ƒê·ªô s√°ng t·∫°o
    topK: 40,             // Top K sampling
    topP: 0.95,           // Top P sampling
    maxOutputTokens: 1024 // Max tokens per response
}</code></pre>

<h4>üîß Methods</h4>
<table>
    <thead>
        <tr>
            <th>Method</th>
            <th>Ch·ª©c nƒÉng</th>
            <th>Input</th>
            <th>Output</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>init()</code></td>
            <td>Kh·ªüi t·∫°o service</td>
            <td>-</td>
            <td>void</td>
        </tr>
        <tr>
            <td><code>askGemini()</code></td>
            <td>Chat text</td>
            <td>prompt string</td>
            <td>AI response text</td>
        </tr>
        <tr>
            <td><code>analyzeWeatherImage()</code></td>
            <td>Ph√¢n t√≠ch ·∫£nh</td>
            <td>buffer, mimetype, prompt</td>
            <td>AI analysis text</td>
        </tr>
        <tr>
            <td><code>chatWithContext()</code></td>
            <td>Chat v·ªõi l·ªãch s·ª≠</td>
            <td>messages array</td>
            <td>AI response</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h3>5.3 C√°ch tr·∫£ v·ªÅ k·∫øt qu·∫£ Chat</h3>

<h4>‚úÖ REST API Endpoints</h4>

<div class="endpoint">
    <p><span class="endpoint-method method-post">POST</span><strong>Chat th√¥ng th∆∞·ªùng</strong></p>
    <pre><code>POST /api/chat
POST /chat (legacy route)

Request Body:
{
  "message": "Th·ªùi ti·∫øt H√† N·ªôi h√¥m nay th·∫ø n√†o?"
}

Response:
{
  "reply": "H√† N·ªôi h√¥m nay tr·ªùi nhi·ªÅu m√¢y, nhi·ªát ƒë·ªô kho·∫£ng 28¬∞C..."
}</code></pre>
    <p><strong>Frontend g·ªçi:</strong> <code>generateAIResponse(message)</code> (Line ~1550)</p>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-post">POST</span><strong>Chat v·ªõi ·∫£nh</strong></p>
    <pre><code>POST /api/chat/image

Request: FormData
- image: File (image file)
- message: String (optional)
- location: String (optional)

Response:
{
  "reply": "T·ª´ ·∫£nh b·∫°n g·ª≠i, t√¥i th·∫•y tr·ªùi ƒëang c√≥ m√¢y ƒëen..."
}</code></pre>
    <p><strong>Frontend g·ªçi:</strong> <code>sendMessageWithImage(message, imageFile)</code> (Line ~1710)</p>
</div>

<h3>5.4 T√≠nh nƒÉng ƒë·∫∑c bi·ªát c·ªßa Chat</h3>

<div class="summary-box">
    <h4>üì∏ Image Upload Features</h4>
    <ul class="feature-list">
        <li><strong>Drag & Drop:</strong> K√©o th·∫£ ·∫£nh v√†o trang web</li>
        <li><strong>File picker:</strong> Click button ƒë·ªÉ ch·ªçn file</li>
        <li><strong>Preview:</strong> Xem tr∆∞·ªõc ·∫£nh tr∆∞·ªõc khi g·ª≠i</li>
        <li><strong>Lightbox:</strong> Click ·∫£nh ƒë·ªÉ ph√≥ng to</li>
        <li><strong>Supported formats:</strong> JPG, PNG, GIF, WebP</li>
        <li><strong>Max size:</strong> 10MB</li>
    </ul>
</div>

<div class="warning-box">
    <h4>üîç Google Search Integration</h4>
    <p><strong>File:</strong> <code>Backend/services/googleSearchService.js</code></p>
    <p><strong>K√≠ch ho·∫°t khi:</strong></p>
    <ul>
        <li>Message ch·ª©a: "tin t·ª©c", "m·ªõi nh·∫•t", "h√¥m nay", "t√¨m ki·∫øm"</li>
        <li>C√¢u h·ªèi ph·ª©c t·∫°p c·∫ßn th√¥ng tin real-time</li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="section-6">6. C·∫§U TR√öC TH∆Ø M·ª§C</h2>

<div class="diagram">
<pre>
DuAnSOAP/
‚îÇ
‚îú‚îÄ‚îÄ Backend/                          # Backend Node.js
‚îÇ   ‚îú‚îÄ‚îÄ server.js                    # Main server (102 lines)
‚îÇ   ‚îú‚îÄ‚îÄ config.js                    # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ package.json                 # Dependencies
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ controllers/                 # Request handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chatController.js       # Chat logic (405 lines)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ weatherController.js    # Weather logic (133 lines)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ imageWeatherController.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/                    # Business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ geminiService.js        # Gemini AI (257 lines)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mapService.js           # Map service (103 lines)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ googleSearchService.js  # Search integration
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ soap/                        # SOAP service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ weatherService.js       # SOAP ops (200 lines)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ weatherWsdl.xml         # WSDL definition
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middleware/                  # Express middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js                # Middleware setup
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ upload.js               # Image upload
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ routes/                      # API routes
‚îÇ       ‚îî‚îÄ‚îÄ index.js                # Routes (104 lines)
‚îÇ
‚îú‚îÄ‚îÄ Frontend/                         # Frontend HTML/CSS/JS
‚îÇ   ‚îú‚îÄ‚îÄ index.html                   # Main page (1925 lines)
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ map.css
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ map-service.js
‚îÇ   ‚îî‚îÄ‚îÄ img/                         # Images
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml                # Docker config
‚îú‚îÄ‚îÄ Dockerfile                        # Docker image
‚îî‚îÄ‚îÄ README.md                         # Documentation
</pre>
</div>

<div class="page-break"></div>

<h2 id="section-7">7. API ENDPOINTS</h2>

<h3>7.1 REST API Endpoints</h3>

<h4>üîπ Weather APIs</h4>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><code>/api/weather?city={cityName}</code></p>
    <p><strong>Description:</strong> L·∫•y th·ªùi ti·∫øt hi·ªán t·∫°i c·ªßa th√†nh ph·ªë</p>
    <p><strong>Controller:</strong> <code>weatherController.getWeatherJSON()</code></p>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><code>/api/weather/forecast?city={cityName}&days={number}</code></p>
    <p><strong>Description:</strong> L·∫•y d·ª± b√°o th·ªùi ti·∫øt nhi·ªÅu ng√†y (1-7 ng√†y)</p>
    <p><strong>Controller:</strong> <code>weatherController.getForecast()</code></p>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-get">GET</span><code>/api/weather/cities</code></p>
    <p><strong>Description:</strong> L·∫•y danh s√°ch th√†nh ph·ªë ƒë∆∞·ª£c h·ªó tr·ª£</p>
    <p><strong>Controller:</strong> <code>weatherController.getSupportedCities()</code></p>
</div>

<h4>üîπ Chat APIs</h4>

<div class="endpoint">
    <p><span class="endpoint-method method-post">POST</span><code>/api/chat</code> ho·∫∑c <code>/chat</code></p>
    <p><strong>Description:</strong> Chat v·ªõi AI bot</p>
    <p><strong>Request:</strong> <code>{ "message": "string" }</code></p>
    <p><strong>Response:</strong> <code>{ "reply": "string" }</code></p>
    <p><strong>Controller:</strong> <code>chatController.handleChat()</code></p>
</div>

<div class="endpoint">
    <p><span class="endpoint-method method-post">POST</span><code>/api/chat/image</code></p>
    <p><strong>Description:</strong> Chat v·ªõi ·∫£nh th·ªùi ti·∫øt</p>
    <p><strong>Request:</strong> FormData with 'image', 'message', 'location'</p>
    <p><strong>Response:</strong> <code>{ "reply": "string" }</code></p>
    <p><strong>Controller:</strong> <code>chatController.handleChatWithImage()</code></p>
</div>

<h3>7.2 SOAP Service</h3>

<div class="endpoint">
    <p><strong>WSDL:</strong> <code>GET http://localhost:3000/weather?wsdl</code></p>
    <p><strong>Operations:</strong></p>
    <ul>
        <li><code>getWeather</code> - L·∫•y th√¥ng tin th·ªùi ti·∫øt</li>
        <li><code>getLocation</code> - L·∫•y th√¥ng tin b·∫£n ƒë·ªì</li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="section-8">8. C√îNG NGH·ªÜ S·ª¨ D·ª§NG</h2>

<h3>8.1 Backend Technologies</h3>
<table>
    <thead>
        <tr>
            <th>C√¥ng ngh·ªá</th>
            <th>Version</th>
            <th>M·ª•c ƒë√≠ch s·ª≠ d·ª•ng</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Node.js</strong></td>
            <td>Latest</td>
            <td>JavaScript runtime</td>
        </tr>
        <tr>
            <td><strong>Express.js</strong></td>
            <td>4.x</td>
            <td>Web framework</td>
        </tr>
        <tr>
            <td><strong>soap</strong></td>
            <td>Latest</td>
            <td>SOAP service implementation</td>
        </tr>
        <tr>
            <td><strong>axios</strong></td>
            <td>Latest</td>
            <td>HTTP client cho API calls</td>
        </tr>
        <tr>
            <td><strong>@google/generative-ai</strong></td>
            <td>Latest</td>
            <td>Google Gemini AI SDK</td>
        </tr>
        <tr>
            <td><strong>multer</strong></td>
            <td>Latest</td>
            <td>File upload handling</td>
        </tr>
        <tr>
            <td><strong>dotenv</strong></td>
            <td>Latest</td>
            <td>Environment variables</td>
        </tr>
        <tr>
            <td><strong>cors</strong></td>
            <td>Latest</td>
            <td>Cross-origin resource sharing</td>
        </tr>
    </tbody>
</table>

<h3>8.2 Frontend Technologies</h3>
<table>
    <thead>
        <tr>
            <th>C√¥ng ngh·ªá</th>
            <th>M·ª•c ƒë√≠ch</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>HTML5</strong></td>
            <td>Markup language</td>
        </tr>
        <tr>
            <td><strong>CSS3</strong></td>
            <td>Styling (gradient, animation, flexbox, grid)</td>
        </tr>
        <tr>
            <td><strong>Vanilla JavaScript</strong></td>
            <td>Client-side logic</td>
        </tr>
        <tr>
            <td><strong>Fetch API</strong></td>
            <td>AJAX requests</td>
        </tr>
        <tr>
            <td><strong>DOMParser</strong></td>
            <td>XML parsing (SOAP responses)</td>
        </tr>
        <tr>
            <td><strong>FormData API</strong></td>
            <td>File upload</td>
        </tr>
        <tr>
            <td><strong>Drag & Drop API</strong></td>
            <td>Image upload UX</td>
        </tr>
    </tbody>
</table>

<h3>8.3 External APIs</h3>
<table>
    <thead>
        <tr>
            <th>API</th>
            <th>Provider</th>
            <th>Purpose</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Weather API</strong></td>
            <td>OpenWeatherMap</td>
            <td>Current weather, forecast</td>
        </tr>
        <tr>
            <td><strong>Geocoding API</strong></td>
            <td>OpenWeatherMap</td>
            <td>City coordinates</td>
        </tr>
        <tr>
            <td><strong>Gemini AI</strong></td>
            <td>Google</td>
            <td>Text generation, image analysis</td>
        </tr>
        <tr>
            <td><strong>OpenStreetMap</strong></td>
            <td>OSM</td>
            <td>Map iframe</td>
        </tr>
        <tr>
            <td><strong>Google Maps</strong></td>
            <td>Google</td>
            <td>Map iframe, satellite view</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h2 id="section-9">9. S∆† ƒê·ªí LU·ªíNG D·ªÆ LI·ªÜU CHI TI·∫æT</h2>

<h3>9.1 Lu·ªìng l·∫•y th·ªùi ti·∫øt (SOAP)</h3>
<div class="diagram">
<pre>
User Input "Hanoi"
       ‚îÇ
       ‚ñº
Frontend: getWeather()
       ‚îÇ
       ‚ñº
fetchWeatherViaSOAP()
Create SOAP XML request
       ‚îÇ
       ‚ñº
POST http://localhost:3000/weather
       ‚îÇ
       ‚ñº
Backend SOAP Service
weatherService.js
       ‚îÇ
       ‚ñº
getWeatherLogic(city)
       ‚îÇ
       ‚ñº
Call OpenWeatherMap API
1. Current Weather API
2. Forecast API
       ‚îÇ
       ‚ñº
Parse & format response
       ‚îÇ
       ‚ñº
Wrap in SOAP XML
       ‚îÇ
       ‚ñº
Frontend: parse XML
       ‚îÇ
       ‚ñº
displayWeather(data)
Update DOM
</pre>
</div>

<h3>9.2 Lu·ªìng chat v·ªõi AI</h3>
<div class="diagram">
<pre>
User types message
       ‚îÇ
       ‚ñº
Frontend: sendMessage()
       ‚îÇ
       ‚ñº
POST /chat with message
       ‚îÇ
       ‚ñº
chatController.handleChat()
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚Üí findCityInMessage()
       ‚îÇ    Found: "H√† N·ªôi"
       ‚îÇ         ‚îÇ
       ‚îÇ         ‚ñº
       ‚îÇ    getWeatherLogic("H√† N·ªôi")
       ‚îÇ    weatherData = {...}
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚Üí needsGoogleSearch()
       ‚îÇ    Check keywords
       ‚îÇ
       ‚ñº
createAIPrompt()
Combine: message + weather + search
       ‚îÇ
       ‚ñº
geminiService.askGemini(prompt)
       ‚îÇ
       ‚ñº
Call Gemini AI API
Model: gemini-2.0-flash
       ‚îÇ
       ‚ñº
AI processes & generates response
       ‚îÇ
       ‚ñº
Return to controller
       ‚îÇ
       ‚ñº
Frontend receives response
       ‚îÇ
       ‚ñº
Display in chatbox
</pre>
</div>

<div class="page-break"></div>

<h2 id="section-10">10. K·∫æT LU·∫¨N</h2>

<h3>10.1 ƒêi·ªÉm m·∫°nh c·ªßa d·ª± √°n</h3>
<div class="summary-box">
    <ul class="feature-list">
        <li><strong>Ki·∫øn tr√∫c hybrid SOAP + REST</strong> - Th·ªÉ hi·ªán hi·ªÉu bi·∫øt v·ªÅ c·∫£ ki·∫øn tr√∫c c≈© v√† m·ªõi</li>
        <li><strong>T√≠ch h·ª£p AI hi·ªán ƒë·∫°i</strong> - S·ª≠ d·ª•ng Google Gemini 2.0 Flash</li>
        <li><strong>Ph√¢n t√≠ch ·∫£nh th√¥ng minh</strong> - Gemini Vision cho weather image analysis</li>
        <li><strong>UI/UX ƒë·∫πp</strong> - Gradient animation, responsive, smooth transitions</li>
        <li><strong>Code structure t·ªët</strong> - Separation of concerns (controllers, services, routes)</li>
        <li><strong>Error handling</strong> - Try-catch blocks, validation middleware</li>
        <li><strong>Multiple data sources</strong> - Weather API + Geocoding + AI</li>
        <li><strong>Interactive map</strong> - Multiple map providers, switch between types</li>
    </ul>
</div>

<h3>10.2 ƒêi·ªÉm c√≥ th·ªÉ c·∫£i thi·ªán</h3>
<div class="warning-box">
    <ul>
        <li>üî∏ <strong>Caching</strong> - Implement Redis/memory cache cho weather data</li>
        <li>üî∏ <strong>Rate limiting</strong> - Protect APIs from abuse</li>
        <li>üî∏ <strong>Authentication</strong> - Add user authentication cho advanced features</li>
        <li>üî∏ <strong>Database</strong> - Store chat history, favorite cities</li>
        <li>üî∏ <strong>Testing</strong> - Unit tests, integration tests</li>
        <li>üî∏ <strong>Logging</strong> - Structured logging (Winston, Morgan)</li>
        <li>üî∏ <strong>API documentation</strong> - Swagger/OpenAPI docs</li>
        <li>üî∏ <strong>i18n</strong> - Multi-language support</li>
    </ul>
</div>

<h3>10.3 Tech Stack Summary</h3>
<div class="diagram">
<pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          FRONTEND                   ‚îÇ
‚îÇ  HTML5 + CSS3 + Vanilla JS          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          BACKEND                    ‚îÇ
‚îÇ  Node.js + Express.js               ‚îÇ
‚îÇ  SOAP Service (node-soap)           ‚îÇ
‚îÇ  REST API                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚ñº             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ External APIs‚îÇ  ‚îÇ AI Service  ‚îÇ
‚îÇ OpenWeather  ‚îÇ  ‚îÇ Gemini 2.0  ‚îÇ
‚îÇ Google Maps  ‚îÇ  ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</pre>
</div>

<div class="page-break"></div>

<h2>PH·ª§ L·ª§C</h2>

<h3>A. Environment Variables</h3>
<pre><code># Server
PORT=3000
NODE_ENV=development

# APIs
OPENWEATHER_API_KEY=your_openweather_api_key
GEMINI_API_KEY=your_gemini_api_key
GOOGLE_SEARCH_API_KEY=your_google_search_key (optional)
GOOGLE_SEARCH_CX=your_custom_search_engine_id (optional)
</code></pre>

<h3>B. Installation & Run</h3>
<pre><code># Install dependencies
cd Backend
npm install

# Create .env file
cp .env.example .env
# Edit .env with your API keys

# Run server
npm start

# Server will be available at:
# http://localhost:3000
</code></pre>

<h3>C. Docker Deployment</h3>
<pre><code># Build and run with Docker Compose
docker-compose up -d

# View logs
docker-compose logs -f

# Stop
docker-compose down
</code></pre>

<hr>

<div style="text-align: center; margin-top: 50px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
    <p><strong>T√†i li·ªáu ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·ª´ ph√¢n t√≠ch m√£ ngu·ªìn</strong></p>
    <p><strong>Repository:</strong> DuAN_TroLyThoiThiet_TraMy</p>
    <p><strong>Owner:</strong> KyThuatTVU</p>
    <p><strong>Ng√†y:</strong> 11/10/2025</p>
    <p><strong>Phi√™n b·∫£n:</strong> 1.0</p>
</div>

</div>

<script>
    // Export to PDF function using browser's print to PDF
    function exportToPDF() {
        const button = document.getElementById('pdf-text');
        const originalText = button.textContent;
        
        // Show loading
        button.innerHTML = '<span class="loading-spinner"></span> ƒêang chu·∫©n b·ªã...';
        
        setTimeout(() => {
            button.textContent = originalText;
            
            // Hide export buttons before printing
            const exportButtons = document.querySelector('.export-buttons');
            exportButtons.style.display = 'none';
            
            // Trigger print dialog
            window.print();
            
            // Show buttons again after print dialog
            setTimeout(() => {
                exportButtons.style.display = 'flex';
                alert('üí° H∆∞·ªõng d·∫´n:\n\n1. Trong h·ªôp tho·∫°i In, ch·ªçn "Destination" ‚Üí "Save as PDF"\n2. Nh·∫•n "Save" ƒë·ªÉ l∆∞u file PDF\n\n‚úÖ File PDF s·∫Ω gi·ªØ nguy√™n m√†u s·∫Øc v√† ƒë·ªãnh d·∫°ng ƒë·∫πp!');
            }, 500);
        }, 300);
    }
    
    // Export to Word function
    function exportToWord() {
        // Show loading message
        alert('üîÑ ƒêang chu·∫©n b·ªã file Word...\n\nVui l√≤ng ch·ªù trong gi√¢y l√°t!');
        
        try {
            // Get the content
            const content = document.getElementById('content');
            const htmlContent = content.innerHTML;
            
            // Create a complete HTML document for Word with proper encoding
            const preHtml = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                      xmlns:w='urn:schemas-microsoft-com:office:word' 
                      xmlns='http://www.w3.org/TR/REC-html40'>
                <head>
                    <meta charset='utf-8'>
                    <title>Ph√¢n T√≠ch D·ª± √Ån - Tr·ª£ L√Ω Th·ªùi Ti·∫øt Tr√† My AI</title>
                    <!--[if gte mso 9]>
                    <xml>
                        <w:WordDocument>
                            <w:View>Print</w:View>
                            <w:Zoom>100</w:Zoom>
                            <w:DoNotOptimizeForBrowser/>
                        </w:WordDocument>
                    </xml>
                    <![endif]-->
                    <style>
                        body { 
                            font-family: 'Segoe UI', 'Calibri', Arial, sans-serif; 
                            line-height: 1.6;
                            max-width: 21cm;
                            margin: 2cm auto;
                            color: #333;
                        }
                        h1 { 
                            color: #2c3e50; 
                            border-bottom: 3px solid #3498db; 
                            padding-bottom: 10px;
                            text-align: center;
                            font-size: 28pt;
                        }
                        h2 { 
                            color: #34495e; 
                            border-bottom: 2px solid #95a5a6; 
                            padding-bottom: 8px; 
                            margin-top: 30px;
                            font-size: 20pt;
                        }
                        h3 { 
                            color: #2980b9; 
                            margin-top: 20px;
                            font-size: 16pt;
                        }
                        h4 {
                            color: #16a085;
                            font-size: 14pt;
                        }
                        pre { 
                            background: #2c3e50; 
                            color: #ecf0f1; 
                            padding: 15px; 
                            border-radius: 5px;
                            font-family: 'Courier New', monospace;
                            white-space: pre-wrap;
                            word-wrap: break-word;
                        }
                        code {
                            background: #ecf0f1;
                            padding: 2px 6px;
                            border-radius: 3px;
                            font-family: 'Courier New', monospace;
                            color: #e74c3c;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin: 20px 0;
                        }
                        th { 
                            background: #3498db; 
                            color: white; 
                            padding: 12px; 
                            text-align: left;
                            font-weight: bold;
                        }
                        td { 
                            padding: 10px; 
                            border: 1px solid #ddd;
                        }
                        tr:nth-child(even) {
                            background: #f8f9fa;
                        }
                        .diagram { 
                            background: #f8f9fa; 
                            padding: 20px; 
                            border: 2px solid #3498db;
                            border-radius: 5px;
                            font-family: monospace;
                        }
                        .metadata {
                            text-align: center;
                            background: #ecf0f1;
                            padding: 15px;
                            border-radius: 5px;
                            margin-bottom: 30px;
                        }
                        .toc {
                            background: #f8f9fa;
                            padding: 20px;
                            border-left: 4px solid #3498db;
                            margin: 30px 0;
                        }
                        .summary-box {
                            background: #e8f5e9;
                            border: 2px solid #4caf50;
                            border-radius: 8px;
                            padding: 20px;
                            margin: 20px 0;
                        }
                        .warning-box {
                            background: #fff3e0;
                            border: 2px solid #ff9800;
                            border-radius: 8px;
                            padding: 20px;
                            margin: 20px 0;
                        }
                        .highlight {
                            background: #fff3cd;
                            padding: 15px;
                            border-left: 4px solid #ffc107;
                            margin: 20px 0;
                        }
                        .endpoint {
                            background: #f1f8ff;
                            border: 1px solid #c8e1ff;
                            border-radius: 5px;
                            padding: 15px;
                            margin: 15px 0;
                        }
                        .feature-list {
                            list-style: none;
                            padding-left: 0;
                        }
                        .feature-list li {
                            padding: 8px 0;
                            padding-left: 30px;
                        }
                        ul {
                            padding-left: 20px;
                        }
                        li {
                            margin: 5px 0;
                        }
                    </style>
                </head>
                <body>`;
            
            const postHtml = `</body></html>`;
            
            const fullHtml = preHtml + htmlContent + postHtml;
            
            // Method 1: Try using Blob and download link
            try {
                // Create blob with BOM for UTF-8
                const blob = new Blob(['\ufeff', fullHtml], {
                    type: 'application/msword;charset=utf-8'
                });
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'PhanTich_DuAn_TraMy_AI.doc';
                link.style.display = 'none';
                
                // Add to DOM and trigger download
                document.body.appendChild(link);
                link.click();
                
                // Cleanup
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                // Show success message
                setTimeout(() => {
                    alert('‚úÖ ƒê√£ xu·∫•t file Word th√†nh c√¥ng!\n\nüìÅ T√™n file: PhanTich_DuAn_TraMy_AI.doc\n\nüí° M·ªü file b·∫±ng Microsoft Word ƒë·ªÉ xem v·ªõi ƒë·ªãnh d·∫°ng ƒë·∫πp.');
                }, 500);
                
            } catch (blobError) {
                // Method 2: Fallback to window.open
                console.warn('Blob method failed, trying window.open:', blobError);
                
                // Create a data URL
                const dataUrl = 'data:application/msword;charset=utf-8,' + encodeURIComponent('\ufeff' + fullHtml);
                
                // Open in new window/tab
                const newWindow = window.open(dataUrl, '_blank');
                
                if (!newWindow) {
                    throw new Error('Popup blocked. Please allow popups for this site.');
                }
                
                // Show instructions
                setTimeout(() => {
                    alert('üìÑ File Word ƒë√£ m·ªü trong tab m·ªõi!\n\nüí° ƒê·ªÉ l∆∞u file:\n1. Nh·∫•n Ctrl+S (ho·∫∑c Cmd+S tr√™n Mac)\n2. Ch·ªçn n∆°i l∆∞u v√† ƒë·∫∑t t√™n: PhanTich_DuAn_TraMy_AI.doc\n3. Nh·∫•n Save');
                }, 1000);
            }
            
        } catch (error) {
            alert('‚ùå L·ªói khi xu·∫•t Word: ' + error.message + '\n\nüí° Th·ª≠ c√°ch kh√°c:\n1. Nh·∫•n Ctrl+P ƒë·ªÉ in\n2. Ch·ªçn "Save as PDF" ƒë·ªÉ l∆∞u PDF\n3. Ho·∫∑c copy n·ªôi dung v√† paste v√†o Word');
        }
    }
    
    // Print function
    function printDocument() {
        // Hide export buttons before printing
        const exportButtons = document.querySelector('.export-buttons');
        exportButtons.style.display = 'none';
        
        // Trigger print dialog
        window.print();
        
        // Show buttons again after print dialog closes
        setTimeout(() => {
            exportButtons.style.display = 'flex';
        }, 500);
    }
    
    // Handle print media query events
    if (window.matchMedia) {
        const mediaQueryList = window.matchMedia('print');
        mediaQueryList.addListener(function(mql) {
            const exportButtons = document.querySelector('.export-buttons');
            if (mql.matches) {
                // Before print
                exportButtons.style.display = 'none';
            } else {
                // After print
                exportButtons.style.display = 'flex';
            }
        });
    }
</script>

</body>
</html>
